{% extends 'core.html' %}



{% block content %}
<div id="search_banner">
		<div id="search-box">
			<form action= "{% url 'search_list'%}" method="get" id="getsearch">
				{% csrf_token %}
				<label>Search a Video
					<input class="form-control" type="text" name="url">
				</label>
					<button class="btn" id="btnsearch" type="submit">Let's search</button>
			</form>
		</div>
				<div id="search_container">
						{% if resultado %}
							<div id="resultbox"><p id="textresult">Hay {{resultado|length}} coincidencias</p></div>
								{% for v in resultado %}

								<div id="position_search_container">
									<div id="textsearchbox">
										<p class="text-center mt-4" id="textsearch"><a href="{{v.watch_url}}" target="_blank" style="color: white; text-decoration: none;" >{{v.title}}</a></p>
										{% csrf_token %}
									</div>
										<iframe src="{{v.embed_url}}" title="{{v.title}}" id="searchpreview" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

										<div id="buttonbox">
											<form action = "/dwnmp3/" method = 'get'>
												{% csrf_token %}
												<button class = 'btn' type="submit" value="MP3" id= "dwmp3">Download MP3</button>
												<input class="form-control" type="hidden" name="vurl3" value = {{v.watch_url}}>
											</form>

											<form action = '/dwnmp4/' method = 'get'>
												{% csrf_token %}
												<button class = 'btn' type="submit" value="MP4" id="dwmp4">Download MP4</button>
												<input class="form-control" type="hidden" name="vurl4" value = {{v.watch_url}}>
											</form>
										</div>			
								</div>
								{% endfor %}
						{% else %}
								{%if historial%}
									<!-- Aca va la consulta al historial de descargas-->
									<div id="resultbox"><p id="textresult">Hay {{historial|length}} descargas en tu historial</p></div>
										<div id="historycontainer">
											<table id="historytable">
												<thead id="historytablehead">
													<tr>
														<th class="historytexthead" id="historydatehead">Fecha</th><th class="historytexthead">Titulo</th><th class="historytexthead" id="historyformathead">Formato</th><th class="historytexthead" id="historyurlhead">URL</th><th class="historytexthead" id="historyamounthead"># Descargas</th><th class="historytexthead" id="historydownloadheadbuttons">Descarga de nuevo</th>
													</tr>
												</thead>
												{%for h in historial%}
														<tr>
															<td id="historycelldate">{{h.fecha}}</td><td id="historytitle" style="text-align: left;" >{{h.titulo}}</td><td id="historyformat">{{h.tipo_descarga}}</td><td id="historyurlcell"><a href="{{h.url}}" target="_blank" style="color: white; text-decoration: none;" id="historyurl">{{h.url}}</a></td><td id="historyamount">{{h.descargas}}</td>
															<td id="historycellbutton">
																{% if h.tipo_descarga == 'MP3' %}
																
																	<form action = "/dwnmp3/" method = 'get'>
																		{% csrf_token %}
																		<button class = 'btn' type="submit" value="MP3" id= "hdwmp3">Download MP3</button>
																		<input class="form-control" type="hidden" name="vurl3" value = {{h.url}}>
																	</form>

																{% else %}
																	<form action = "/dwnmp4/" method = 'get'>
																		{% csrf_token %}
																		<button class = 'btn' type="submit" value="MP4" id="hdwmp4">Download MP4</button>
																		<input class="form-control" type="hidden" name="vurl4" value = {{h.url}}>
																	</form>
																{% endif %}
																{% comment "buttons commented" %}
																<div>
																	<form action = "/dwnmp3/" method = 'get'>
																		{% csrf_token %}
																		<button class = 'btn' type="submit" value="MP3" id= "hdwmp3">Download MP3</button>
																		<input class="form-control" type="hidden" name="vurl3" value = {{h.url}}>
																	</form>
						
																	<form action = "/dwnmp4/" method = 'get'>
																		{% csrf_token %}
																		<button class = 'btn' type="submit" value="MP4" id="hdwmp4">Download MP4</button>
																		<input class="form-control" type="hidden" name="vurl4" value = {{h.url}}>
																	</form>
																</div>
																{% endcomment %}
															</td>
														</tr>
												{%endfor%}
											</table>
										</div>	
									</div>
								{%else%}
								<div id="resultbox"><p id="textresult">El usuario: {{v.user_email}}  no tiene descargas a√∫n</p></div>
								{%endif%}
						{% endif %}
				</div>
</div>
{% endblock content %}
